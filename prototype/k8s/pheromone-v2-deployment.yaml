apiVersion: apps/v1
kind: Deployment
metadata:
  name: aswarm-pheromone-v2  
  namespace: aswarm
  labels:
    app.kubernetes.io/name: aswarm-pheromone
    app.kubernetes.io/component: pheromone
    app.kubernetes.io/version: v0.2
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: aswarm-pheromone
      app.kubernetes.io/component: pheromone
  template:
    metadata:
      labels:
        app.kubernetes.io/name: aswarm-pheromone
        app.kubernetes.io/component: pheromone
        app.kubernetes.io/version: v0.2
    spec:
      serviceAccountName: aswarm-pheromone-v2
      containers:
      - name: pheromone
        image: python:3.11-slim
        command:
        - /bin/bash
        - -c
        - |
          cd /app && pip install kubernetes && python -m pheromone.gossip_v2 \
            --namespace=aswarm --window-ms=500 --quorum=2
        env:
        - name: PYTHONPATH
          value: "/app"
        volumeMounts:
        - name: app-code
          mountPath: /app
          readOnly: true
        resources:
          limits:
            cpu: 200m
            memory: 100Mi
          requests:
            cpu: 20m
            memory: 40Mi
      volumes:
      - name: app-code
        configMap:
          name: aswarm-app-code